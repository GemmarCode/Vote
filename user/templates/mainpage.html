{% extends 'base.html' %}
{% load static %}

{% block content %}
{% include 'nav.html' %}

<!-- Hero Section -->
<div class="hero-section py-5" style="background: linear-gradient(135deg, var(--primary), var(--primary-light));">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 text-center text-lg-start mb-4 mb-lg-0">
                <h1 class="display-4 fw-bold text-white mb-3">NORSU-BSC Web-Based Voting System</h1>
                <p class="lead text-white-75 mb-4">Your secure and efficient university election platform with face recognition technology.</p>
                <div class="d-grid gap-2 d-sm-flex">
                    <a href="{% url 'user:candidates' %}" class="btn btn-lg px-4" style="background-color: var(--light); color: var(--dark);">
                        <i class="fas fa-users me-2"></i>View Candidates
                    </a>
                    </a>
                </div>
            </div>
            
        </div>
    </div>
</div>

<!-- Election Status Section -->
<div id="election-status-container" class="container mt-4">
{% if election_settings.candidacy_deadline %}
    <div id="candidacy-countdown-container" class="countdown-container">
        <div class="countdown-header">
            <div class="countdown-title">
                <i class="fas fa-hourglass-half countdown-icon"></i>
                <h4>Filing of Candidacy Deadline</h4>
            </div>
            <p class="countdown-subtitle">
                <i class="far fa-calendar-alt"></i>
                {{ election_settings.candidacy_deadline|date:"F d, Y" }} at {{ election_settings.candidacy_deadline|date:"h:i A" }}
            </p>
        </div>
        
        <div id="candidacy-countdown" class="countdown-grid">
            <!-- Time units will be inserted here by JavaScript -->
        </div>
    </div>
{% endif %}

{% if election_settings.voting_start and election_settings.voting_end %}
    <div id="voting-countdown-container" class="countdown-container voting-countdown" style="display: none;">
        <div class="countdown-header">
            <div class="countdown-title">
                <i class="fas fa-vote-yea countdown-icon"></i>
                <h4>Voting Period</h4>
            </div>
            <p class="countdown-subtitle">
                <i class="far fa-calendar-alt"></i>
                {{ election_settings.voting_start|date:"F d, Y" }} at {{ election_settings.voting_start|date:"h:i A" }}
                to
                {{ election_settings.voting_end|date:"F d, Y" }} at {{ election_settings.voting_end|date:"h:i A" }}
            </p>
        </div>
        
        <div id="voting-countdown" class="countdown-grid">
            <!-- Time units will be inserted here by JavaScript -->
        </div>
    </div>
{% endif %}
</div>

<script>
// Global management of election status display
window.addEventListener('DOMContentLoaded', function() {
    {% if election_settings.candidacy_deadline and election_settings.voting_start and election_settings.voting_end %}
    // Get time values in milliseconds
    const candidacyDeadlineTime = new Date("{{ election_settings.candidacy_deadline|date:'Y-m-d H:i:s' }}").getTime();
    const votingStartTime = new Date("{{ election_settings.voting_start|date:'Y-m-d H:i:s' }}").getTime();
    const votingEndTime = new Date("{{ election_settings.voting_end|date:'Y-m-d H:i:s' }}").getTime();
    
    // Check the current election phase and show the appropriate container
    function updateElectionDisplay() {
        const currentTime = new Date().getTime();
        const candidacyContainer = document.getElementById('candidacy-countdown-container');
        const votingContainer = document.getElementById('voting-countdown-container');
        
        // Candidacy filing phase
        if (currentTime < candidacyDeadlineTime) {
            if (candidacyContainer) candidacyContainer.style.display = 'block';
            if (votingContainer) votingContainer.style.display = 'none';
        }
        // After candidacy ended, show voting countdown
        else {
            if (candidacyContainer) candidacyContainer.style.display = 'none';
            if (votingContainer) votingContainer.style.display = 'block';
        }
    }
    
    // Run once on page load
    updateElectionDisplay();
    
    // Check every minute
    setInterval(updateElectionDisplay, 60000);
    {% endif %}

    {% if election_settings.candidacy_deadline %}
    // Candidacy deadline countdown
    const candidacyDeadline = new Date("{{ election_settings.candidacy_deadline|date:'Y-m-d H:i:s' }}").getTime();
    
    function updateCandidacyCountdown() {
        const now = new Date().getTime();
        const distance = candidacyDeadline - now;
        
        if (distance < 0) {
            // Candidacy filing has ended
            document.getElementById('candidacy-countdown').innerHTML = 
                '<div class="countdown-ended"><i class="fas fa-clock me-3"></i>Filing of Candidacy Has Ended</div>';
            return false; // Stop the countdown
        }
        
        // Time calculations
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        // Display the countdown
        document.getElementById('candidacy-countdown').innerHTML = `
            <div class="countdown-unit">
                <p class="countdown-number">${String(days).padStart(2, '0')}</p>
                <p class="countdown-label">Days</p>
            </div>
            <div class="countdown-unit">
                <p class="countdown-number">${String(hours).padStart(2, '0')}</p>
                <p class="countdown-label">Hours</p>
            </div>
            <div class="countdown-unit">
                <p class="countdown-number">${String(minutes).padStart(2, '0')}</p>
                <p class="countdown-label">Minutes</p>
            </div>
            <div class="countdown-unit">
                <p class="countdown-number">${String(seconds).padStart(2, '0')}</p>
                <p class="countdown-label">Seconds</p>
            </div>
        `;
        
        return true; // Continue the countdown
    }
    
    // Initial update
    if (updateCandidacyCountdown()) {
        // Set interval only if countdown should continue
        setInterval(updateCandidacyCountdown, 1000);
    }
    {% endif %}
    
    {% if election_settings.voting_start and election_settings.voting_end %}
    // Voting period countdown
    const votingStart = new Date("{{ election_settings.voting_start|date:'Y-m-d H:i:s' }}").getTime();
    const votingEnd = new Date("{{ election_settings.voting_end|date:'Y-m-d H:i:s' }}").getTime();
    
    function updateVotingCountdown() {
        const now = new Date().getTime();
        const distanceToStart = votingStart - now;
        const distanceToEnd = votingEnd - now;
        
        // Voting hasn't started yet
        if (distanceToStart > 0) {
            // Time calculations
            const days = Math.floor(distanceToStart / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distanceToStart % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distanceToStart % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distanceToStart % (1000 * 60)) / 1000);
            
            document.getElementById('voting-countdown').innerHTML = `
                <div class="voting-waiting">
                    <i class="fas fa-clock me-3"></i>Voting Starts In
                </div>
                <div class="countdown-unit">
                    <p class="countdown-number">${String(days).padStart(2, '0')}</p>
                    <p class="countdown-label">Days</p>
                </div>
                <div class="countdown-unit">
                    <p class="countdown-number">${String(hours).padStart(2, '0')}</p>
                    <p class="countdown-label">Hours</p>
                </div>
                <div class="countdown-unit">
                    <p class="countdown-number">${String(minutes).padStart(2, '0')}</p>
                    <p class="countdown-label">Minutes</p>
                </div>
                <div class="countdown-unit">
                    <p class="countdown-number">${String(seconds).padStart(2, '0')}</p>
                    <p class="countdown-label">Seconds</p>
                </div>
            `;
        }
        // Voting is active
        else if (distanceToEnd > 0) {
            // Time calculations
            const days = Math.floor(distanceToEnd / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distanceToEnd % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distanceToEnd % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distanceToEnd % (1000 * 60)) / 1000);
            
            document.getElementById('voting-countdown').innerHTML = `
                <div class="voting-active">
                    <i class="fas fa-vote-yea me-3"></i>Voting Is Now Open
                </div>
                <div class="countdown-unit">
                    <p class="countdown-number">${String(days).padStart(2, '0')}</p>
                    <p class="countdown-label">Days</p>
                </div>
                <div class="countdown-unit">
                    <p class="countdown-number">${String(hours).padStart(2, '0')}</p>
                    <p class="countdown-label">Hours</p>
                </div>
                <div class="countdown-unit">
                    <p class="countdown-number">${String(minutes).padStart(2, '0')}</p>
                    <p class="countdown-label">Minutes</p>
                </div>
                <div class="countdown-unit">
                    <p class="countdown-number">${String(seconds).padStart(2, '0')}</p>
                    <p class="countdown-label">Seconds</p>
                </div>
            `;
        }
        // Voting has ended
        else {
            document.getElementById('voting-countdown').innerHTML = `
                <div class="voting-ended">
                    <i class="fas fa-check-circle me-3"></i>Voting Has Ended
                </div>
            `;
            return false; // Stop the countdown
        }
        
        return true; // Continue the countdown
    }
    
    // Initial update
    if (updateVotingCountdown()) {
        // Set interval only if countdown should continue
        setInterval(updateVotingCountdown, 1000);
    }
    {% endif %}
});
</script>

<style>
.countdown-container {
    background: #ffffff;
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 
        20px 20px 60px rgba(25, 118, 210, 0.1),
        -20px -20px 60px rgba(255, 255, 255, 0.8);
    position: relative;
    overflow: hidden;
}

.countdown-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, var(--primary), var(--primary-light), var(--primary));
    background-size: 200% 100%;
    animation: gradientMove 3s linear infinite;
}

.voting-countdown::before {
    background: linear-gradient(90deg, #1976D2, #42A5F5, #1976D2);
}

@keyframes gradientMove {
    0% { background-position: 100% 0; }
    100% { background-position: -100% 0; }
}

.countdown-header {
    text-align: center;
    margin-bottom: 2rem;
}

.countdown-title {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.countdown-icon {
    font-size: 2rem;
    color: var(--primary);
    animation: hourglassFlip 2s infinite;
}

@keyframes hourglassFlip {
    0% { transform: rotate(0deg); }
    50% { transform: rotate(180deg); }
    100% { transform: rotate(360deg); }
}

.countdown-title h4 {
    color: var(--primary);
    font-size: 1.8rem;
    font-weight: 700;
    margin: 0;
}

.countdown-subtitle {
    color: #6c757d;
    font-size: 1.1rem;
    margin: 0;
}

.countdown-subtitle i {
    margin-right: 0.5rem;
    color: var(--primary);
}

.countdown-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1.5rem;
    padding: 1rem;
}

.countdown-unit {
    background: #ffffff;
    border-radius: 15px;
    padding: 1.5rem;
    text-align: center;
    box-shadow: 
        8px 8px 16px rgba(25, 118, 210, 0.1),
        -8px -8px 16px rgba(255, 255, 255, 0.8);
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease;
}

.countdown-unit::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(145deg, var(--primary), var(--primary-light));
    opacity: 0.1;
    transition: opacity 0.3s ease;
}

.countdown-unit:hover {
    transform: translateY(-5px);
}

.countdown-unit:hover::before {
    opacity: 0.2;
}

.countdown-number {
    font-size: 3.5rem;
    font-weight: 800;
    color: var(--primary);
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    margin: 0;
    line-height: 1;
    position: relative;
}

.countdown-label {
    color: #6c757d;
    font-size: 1rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-top: 0.5rem;
    position: relative;
}

.countdown-ended, .voting-ended {
    background: linear-gradient(145deg, #dc3545, #ff6b6b);
    color: white;
    padding: 2rem;
    border-radius: 15px;
    font-size: 2rem;
    font-weight: 800;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 2px;
    box-shadow: 0 10px 20px rgba(220, 53, 69, 0.3);
    animation: pulseEnd 2s infinite;
}

.voting-active {
    background: linear-gradient(145deg, #28a745, #5cb85c);
    color: white;
    padding: 2rem;
    border-radius: 15px;
    font-size: 2rem;
    font-weight: 800;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 2px;
    box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
    animation: pulseActive 2s infinite;
}

.voting-waiting {
    background: linear-gradient(145deg, #fd7e14, #ffb44f);
    color: white;
    padding: 2rem;
    border-radius: 15px;
    font-size: 2rem;
    font-weight: 800;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 2px;
    box-shadow: 0 10px 20px rgba(253, 126, 20, 0.3);
    animation: pulseWaiting 2s infinite;
}

@keyframes pulseEnd {
    0% { transform: scale(1); box-shadow: 0 10px 20px rgba(220, 53, 69, 0.3); }
    50% { transform: scale(1.05); box-shadow: 0 15px 30px rgba(220, 53, 69, 0.4); }
    100% { transform: scale(1); box-shadow: 0 10px 20px rgba(220, 53, 69, 0.3); }
}

@keyframes pulseActive {
    0% { transform: scale(1); box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3); }
    50% { transform: scale(1.05); box-shadow: 0 15px 30px rgba(40, 167, 69, 0.4); }
    100% { transform: scale(1); box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3); }
}

@keyframes pulseWaiting {
    0% { transform: scale(1); box-shadow: 0 10px 20px rgba(253, 126, 20, 0.3); }
    50% { transform: scale(1.05); box-shadow: 0 15px 30px rgba(253, 126, 20, 0.4); }
    100% { transform: scale(1); box-shadow: 0 10px 20px rgba(253, 126, 20, 0.3); }
}

.text-white-75 {
    color: rgba(255, 255, 255, 0.75);
}

.feature-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background-color: var(--light);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
}

.timeline .card {
    border-left: 4px solid var(--primary);
    margin-left: 20px;
}

.card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 8px 16px rgba(25, 118, 210, 0.15) !important;
    border-radius: 15px !important;
    border: 1px solid rgba(25, 118, 210, 0.08) !important;
    overflow: hidden;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(25, 118, 210, 0.25) !important;
    border: 1px solid rgba(25, 118, 210, 0.15) !important;
}

.btn {
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.section-title {
    color: var(--primary) !important;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1) !important;
    position: relative;
    display: block;
    padding: 0 15px;
    font-weight: 700;
    text-align: center;
    margin: 0 auto;
    width: 100%;
}

.section-title:before, .section-title:after {
    content: '';
    display: block;
    height: 3px;
    position: absolute;
    background-color: var(--primary);
    width: 80px;
    transition: width 0.5s ease;
    top: 50%;
}

.section-title:before {
    left: 20%;
}

.section-title:after {
    right: 20%;
}

.section-title:hover:before {
    width: 100px;
    left: 18%;
}

.section-title:hover:after {
    width: 100px;
    right: 18%;
}
</style>

<!-- Features Section -->
<div class="py-5" style="background-color: var(--light);">
    <div class="container">
        <h2 class="text-center mb-5 fw-bold section-title">Negros Oriental State University</h2>
        <div class="row g-4">
            <!-- Feature 1 -->
            <div class="col-md-4">
                <div class="card h-100 border-0">
                    <div class="card-body text-center p-4">
                        <div class="feature-icon mb-3">
                            <i class="fas fa-graduation-cap fa-3x" style="color: var(--primary);"></i>
                        </div>
                        <h4 class="card-title mb-3" style="color: var(--primary);">Mission</h4>
                        <p class="card-text" style="color: #000000;">Negros Oriental State University delivers global excellence through advanced instruction, impactful research, and sustainable extension, with strategic partnerships and modern infrastructure shaping effective leaders to serve the Philippine society and the world.</p>
                    </div>
                </div>
            </div>
            
            <!-- Feature 2 -->
            <div class="col-md-4">
                <div class="card h-100 border-0">
                    <div class="card-body text-center p-4">
                        <div class="feature-icon mb-3">
                            <i class="fas fa-lightbulb fa-3x" style="color: var(--primary);"></i>
                        </div>
                        <h4 class="card-title mb-3" style="color: var(--primary);">Vision</h4>
                        <p class="card-text" style="color: #000000;">A globally recognized state university.</p>
                    </div>
                </div>
            </div>
            
            <!-- Feature 3 -->
            <div class="col-md-4">
                <div class="card h-100 border-0">
                    <div class="card-body text-center p-4">
                        <div class="feature-icon mb-3">
                            <i class="fas fa-star fa-3x" style="color: var(--primary);"></i>
                        </div>
                        <h4 class="card-title mb-3" style="color: var(--primary);">Core Values</h4>
                        <p class="card-text" style="color: #000000;"><span style="color: var(--primary);">𝐒</span>pirituality
                            <span style="color: var(--primary);">𝐇</span>onesty
                            <span style="color: var(--primary);">𝐈</span>nnovation
                            <span style="color: var(--primary);">𝐍</span>urturance
                            <span style="color: var(--primary);">𝐄</span>xcellence</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Election Timeline -->
<div class="py-5" style="background-color: var(--light);">
    <div class="container">
        <h2 class="text-center mb-5 fw-bold section-title">Election Timeline</h2>
        <div class="row">
            <div class="col-md-12">
                <div class="timeline">
                    <div class="card border-0 mb-3">
                        <div class="card-body">
                            <h5 class="card-title" style="color: var(--primary);">Filing of Candidacy</h5>
                            <p class="card-text" style="color: #000000;">March 1-15, 2024</p>
                        </div>
                    </div>
                    <div class="card border-0 mb-3">
                        <div class="card-body">
                            <h5 class="card-title" style="color: var(--primary);">Campaign Period</h5>
                            <p class="card-text" style="color: #000000;">March 16-31, 2024</p>
                        </div>
                    </div>
                    <div class="card border-0 mb-3">
                        <div class="card-body">
                            <h5 class="card-title" style="color: var(--primary);">Election Day</h5>
                            <p class="card-text" style="color: #000000;">April 1, 2024</p>
                        </div>
                    </div>
                    <div class="card border-0">
                        <div class="card-body">
                            <h5 class="card-title" style="color: var(--primary);">Results Announcement</h5>
                            <p class="card-text" style="color: #000000;">April 2, 2024</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}