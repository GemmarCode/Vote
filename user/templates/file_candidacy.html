{% extends 'base.html' %}
{% load static %}

{% block content %}
{% include 'nav.html' %}

<div class="min-vh-100" style="background-color: #D1ECFF;">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8">
                <div class="card shadow-lg border-0" style="background-color: #CBEAEC;">
                    <div class="card-body p-4 p-md-5">
                        <h2 class="text-center mb-4 fw-bold" style="color: #1E5470;">File Your Candidacy</h2>
<!-- 
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        {% endif %} -->

                        <form method="POST" action="{% url 'file_candidacy' %}" enctype="multipart/form-data" class="needs-validation" novalidate>
                            {% csrf_token %}
                            
                            <!-- Position Information -->
                            <div class="row mb-4">
                                <h5 class="mb-3" style="color: #34729C;">
                                    <i class="fas fa-star me-2"></i>Position Details
                                </h5>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Election Level*</label>
                                    <select class="form-select" name="election_level" id="electionLevel" required onchange="updatePositions()">
                                        <option value="">Select Level</option>
                                        <option value="national">National</option>
                                        <option value="local">Local</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Position*</label>
                                    <select class="form-select" name="position" id="position" required>
                                        <option value="">Select Position</option>
                                    </select>
                                </div>
                                <div class="col-12 mb-3">
                                    <label class="form-label">Platform/Agenda*</label>
                                    <textarea class="form-control" name="platform" rows="4" required 
                                              placeholder="Share your plans and goals..."
                                              style="background-color: #D1ECFF;"></textarea>
                                </div>
                            </div>

                            <!-- Personal Information -->
                            <div class="row mb-4">
                                <h5 class="mb-3" style="color: #34729C;">
                                    <i class="fas fa-user me-2"></i>Personal Information
                                </h5>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">First Name</label>
                                    <input type="text" class="form-control bg-light" 
                                           value="{{ initial_data.first_name|default_if_none:'' }}" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" class="form-control bg-light" 
                                           value="{{ initial_data.last_name|default_if_none:'' }}" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Age</label>
                                    <input type="number" class="form-control bg-light" 
                                           value="{{ initial_data.age|default_if_none:'' }}" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Gender</label>
                                    <input type="text" class="form-control bg-light" 
                                           value="{{ initial_data.gender|default_if_none:'' }}" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Contact Number*</label>
                                    <input type="tel" class="form-control" name="contact_number" 
                                           value="{{ initial_data.contact_number|default_if_none:'' }}" required>
                                </div>
                            </div>

                            <!-- Academic Information -->
                            <div class="row mb-4">
                                <h5 class="mb-3" style="color: #34729C;">
                                    <i class="fas fa-graduation-cap me-2"></i>Academic Information
                                </h5>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Student ID</label>
                                    <input type="text" class="form-control bg-light" 
                                           value="{{ initial_data.student_id|default_if_none:'' }}" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">College</label>
                                    <input type="text" class="form-control bg-light" 
                                           value="{{ initial_data.get_college_display|default_if_none:'' }}" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Department</label>
                                    <input type="text" class="form-control bg-light" 
                                           value="{{ initial_data.department|default_if_none:'' }}" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Year Level</label>
                                    <input type="text" class="form-control bg-light" 
                                           value="{{ initial_data.year_level|default_if_none:'' }}" readonly>
                                </div>
                                
                                <div class="col-12 mb-3">
                                    <label class="form-label">Achievements*</label>
                                    <textarea class="form-control" name="achievements" rows="4" required 
                                              placeholder="List your academic and leadership achievements..."
                                              style="background-color: #D1ECFF;"></textarea>
                                </div>
                            </div>

                            <!-- Profile Picture -->
                            <div class="row mb-4">
                                <h5 class="mb-3" style="color: #34729C;">
                                    <i class="fas fa-camera me-2"></i>Profile Picture
                                </h5>
                                <div class="col-12">
                                    <div class="d-flex justify-content-center mb-3">
                                        <img id="preview" src="{% static 'images/default-profile.png' %}" 
                                             class="rounded-circle" 
                                             style="width: 150px; height: 150px; object-fit: cover; border: 3px solid #34729C;">
                                    </div>
                                    <div class="input-group">
                                        <input type="file" class="form-control" name="photo" 
                                               accept="image/*" required
                                               onchange="previewImage(this);">
                                        <label class="input-group-text" style="background-color: #6CB1DA;">
                                            <i class="fas fa-upload"></i>
                                        </label>
                                    </div>
                                    <div class="form-text text-center">Upload a clear, professional photo</div>
                                </div>
                            </div>

                            <!-- Requirements -->
                            <div class="row mb-4">
                                <h5 class="mb-3" style="color: #34729C;">
                                    <i class="fas fa-check-circle me-2"></i>Requirements
                                </h5>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="agreement" required>
                                        <label class="form-check-label">
                                            I certify that all information provided is true and correct.
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-lg" style="background-color: #34729C; color: white;">
                                    <i class="fas fa-paper-plane me-2"></i>Submit Application
                                </button>
                                <a href="{% url 'home' %}" class="btn btn-lg" style="background-color: #6CB1DA; color: white;">
                                    <i class="fas fa-arrow-left me-2"></i>Back to Home
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('preview').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function updatePositions() {
    const electionLevel = document.getElementById('electionLevel').value;
    const positionSelect = document.getElementById('position');
    
    positionSelect.innerHTML = '<option value="">Select Position</option>';
    
    const positions = {
        'national': [
            ['PRESIDENT', 'President'],
            ['VICE_PRESIDENT', 'Vice President'],
            ['SECRETARY', 'Secretary'],
            ['TREASURER', 'Treasurer'],
            ['AUDITOR', 'Auditor'],
            ['PIO', 'Public Information Officer'],
            ['REPRESENTATIVE', 'Representative'],
            ['GOVERNOR', 'Governor'],
            ['VICE_GOVERNOR', 'Vice Governor'],
            ['SEC_GOVERNOR', 'Secretary'],
            ['TRES_GOVERNOR', 'Treasurer'],
            ['AUD_GOVERNOR', 'Auditor'],
            ['PIO_GOVERNOR', 'Public Information Officer']
        ],
        'local': [
            ['MAYOR', 'Mayor'],
            ['VICE_MAYOR', 'Vice Mayor'],
            ['SEC_LOCAL', 'Secretary'],
            ['TRES_LOCAL', 'Treasurer'],
            ['AUD_LOCAL', 'Auditor'],
            ['PIO_LOCAL', 'Public Information Officer'],
            ['REP_LOCAL', 'Representative']
        ]
    };

    if (positions[electionLevel]) {
        positions[electionLevel].forEach(([code, display]) => {
            const option = document.createElement('option');
            option.value = code;
            option.textContent = display;
            positionSelect.appendChild(option);
        });
    }
}

// Form validation
(function () {
    'use strict'
    const forms = document.querySelectorAll('.needs-validation')
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
            }
            form.classList.add('was-validated')
        }, false)
    })
})()
</script>
{% endblock %} 