{% extends 'admin_base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <!-- Excel Import Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title">Import Student Data from Excel</h3>
                </div>
                <div class="card-body">
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                    
                    <form method="POST" enctype="multipart/form-data" action="{% url 'admin_panel:import_users' %}">
                        {% csrf_token %}
                        <div class="form-group mb-3">
                            <label for="excel_file">Excel File</label>
                            <input type="file" class="form-control" id="excel_file" name="excel_file" accept=".xlsx, .xls" required>
                            <small class="form-text text-muted">
                                Excel file should have columns: student_id, student_name, sex, year_level, course, college
                            </small>
                        </div>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-file-excel me-2"></i>Import Student Data
                        </button>
                    </form>
                </div>
            </div>

            <!-- Photo Import Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title">Import Student Photos</h3>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data" action="{% url 'admin_panel:import_photos' %}">
                        {% csrf_token %}
                        <div class="form-group mb-3">
                            <label for="photos_zip">Student Photos (ZIP file)</label>
                            <input type="file" class="form-control" id="photos_zip" name="photos_zip" accept=".zip" required>
                            <small class="form-text text-muted">
                                Upload a ZIP file containing photos named as student_id.jpg/png (e.g., 2020-0001.jpg)
                            </small>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-images me-2"></i>Import Student Photos
                        </button>
                    </form>
                </div>
            </div>

            <!-- Manual Registration Card -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Register Single User</h3>
                </div>
                <div class="card-body">
                    <form method="POST" class="needs-validation" enctype="multipart/form-data" novalidate>
                        {% csrf_token %}
                        <div class="form-group mb-3">
                            <label for="student_id">Student ID</label>
                            <input type="text" class="form-control" id="student_id" name="student_id" required>
                            <div class="invalid-feedback">
                                Please provide a student ID.
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="student_name">Student Name</label>
                            <input type="text" class="form-control" id="student_name" name="student_name" required>
                            <div class="invalid-feedback">
                                Please provide the student's name.
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="sex">Sex</label>
                            <select class="form-select" id="sex" name="sex" required>
                                <option value="">Select Sex</option>
                                <option value="M">Male</option>
                                <option value="F">Female</option>
                            </select>
                            <div class="invalid-feedback">
                                Please select sex.
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="year_level">Year Level</label>
                            <select class="form-select" id="year_level" name="year_level" required>
                                <option value="">Select Year Level</option>
                                <option value="1">First Year</option>
                                <option value="2">Second Year</option>
                                <option value="3">Third Year</option>
                                <option value="4">Fourth Year</option>
                                <option value="5">Fifth Year</option>
                            </select>
                            <div class="invalid-feedback">
                                Please select year level.
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="course">Course</label>
                            <input type="text" class="form-control" id="course" name="course" required>
                            <div class="invalid-feedback">
                                Please provide the course.
                            </div>
                        </div>

                        <div class="form-group mb-3">
                            <label for="college">College</label>
                            <select class="form-select" id="college" name="college" required>
                                <option value="">Select College</option>
                                <option value="CAS">College of Arts and Sciences</option>
                                <option value="CAF">College of Agriculture and Forestry</option>
                                <option value="CCJE">College of Criminal Justice Education</option>
                                <option value="CBA">College of Business Administration</option>
                                <option value="CTED">College of Teacher Education</option>
                                <option value="CIT">College of Industrial Technology</option>
                            </select>
                            <div class="invalid-feedback">
                                Please select a college.
                            </div>
                        </div>

                        <div class="form-group mb-3">
                            <label for="photo">Student Photo</label>
                            <input type="file" class="form-control" id="photo" name="photo" accept="image/*">
                            <div class="invalid-feedback">
                                Please provide a photo.
                            </div>
                            <div class="alert alert-info mt-2">
                                <h6 class="mb-2"><i class="fas fa-info-circle me-2"></i>Photo Requirements:</h6>
                                <ul class="mb-0">
                                    <li>Use a clear, front-facing photo</li>
                                    <li>Ensure good lighting and minimal shadows</li>
                                    <li>Face should be centered and clearly visible</li>
                                    <li>Use original, unedited photos (no filters or effects)</li>
                                    <li>Recommended resolution: at least 800x800 pixels</li>
                                    <li>File format: JPG or PNG</li>
                                    <li>Maximum file size: 5MB</li>
                                </ul>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Register User</button>
                        <a href="{% url 'admin_panel:manage_users' %}" class="btn btn-secondary">Cancel</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Form validation script
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();
</script>
{% endblock %} 